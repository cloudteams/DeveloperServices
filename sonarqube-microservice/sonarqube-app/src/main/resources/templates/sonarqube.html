<div th:fragment="sonarqube-no-auth">

    <div class="alert alert-warning">Please synchronize your Sonarqube account</div>

    <div class="form-group">
        <label for="sonar-url">Sonarqube Url</label>
        <input type="text" name="lastname" id="sonar-url" class="form-control" placeholder="http://" value="" />
    </div>

    <button id="btn-oauth" onclick="synchronizeSonarqube()" class="btn btn-danger">Synchronize Sonarqube</button>
    <br/>

    <script th:inline="javascript">

        function synchronizeSonarqube() {
            $.post({
                data: {username: ct_user_name, sonarUrl: $("#sonar-url").val()},
                url: CLOUDTEAMS_SONARQUBE_REST_ENDPOINT + "/auth/token"
            }).success(function (data, status, xhr) {

                var res = JSON.parse(data);
                if ("SUCCESS" === res.code) {
                    localStorage.sonarqube_auth_token = res.token;
                    loadSonarqubeWidget();
                } else {
                    console.log("Could not synchronize");
                }

            });
        }

    </script>
</div>

<div th:fragment="sonarqube-no-project">
    <div class="alert alert-warning">Please select a Sonarqube project</div>
    <select id="projects" th:if="${!sonarqubeProjects.isEmpty()}">
        <option th:each="project : ${sonarqubeProjects}" th:value="${project.getK()}" th:text="${project.getNm()}"></option>
    </select>
    <button id="btn-oauth" onclick="assignProject()" class="btn btn-danger">Assign Project</button>

    <script th:inline="javascript">

        function assignProject() {

            $.post({
                url: CLOUDTEAMS_SONARQUBE_REST_ENDPOINT + "/sonarqube/add",
                data: {project_id: ct_project_id, projectName: $("#projects :selected").val()},
                beforeSend: function (xhr) {
                    if (hasSonarqubeAccessToken()) {
                        xhr.setRequestHeader("Authorization", localStorage.sonarqube_auth_token);
                    }
                },
            }).success(function (data, status, xhr) {

                var res = JSON.parse(data);
                if ("SUCCESS" === res.code) {
                    console.log("Success assigned project, reload Sonarqube widget");
                    //Reload Github widget
                    loadSonarqubeWidget();
                } else {
                    console.log("Could not assign project");
                }
            });
        }

    </script>
</div>


<div th:fragment="sonarqube-auth-project">
    <div class="alert alert-warning">Sonarqube project statistics</div>
    <div th:inline="text"><strong>Project name:</strong> [[${projectInfo.getProjectName()}]]</div>
    <div th:inline="text"><strong>Version:</strong> [[${projectInfo.getVersion()}]]</div>
    <div th:inline="text"><strong>Description:</strong> [[${projectInfo.getDescription()}]]</div>
    <div th:inline="text"><strong>Total Issues:</strong> [[${projectInfo.getTotalIssues()}]]</div>
    <strong>Project metrics</strong>
    <!-- Iterate all metrics -->
    <ul id="metrics" th:each="metric : ${projectInfo.getMetrics()}">
        <li> <span th:text="${metric.key}"></span> : <span th:text="${metric.value}"></span> </li>
    </ul>

</div>

<div th:fragment="sonarqube-error">
    <img id="error_image" width="200px" src="data:image/png;base64,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"  />
    <div class="alert alert-danger" >
        <strong>ERROR !!!</strong>
        <br/>
        <span>Page request does not completed that's all we know.<br /></span>
    </div>
</div>
